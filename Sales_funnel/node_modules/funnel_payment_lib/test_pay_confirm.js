/**
 * Created by daulet on 8/31/16.
 */
var http = require('http');
const querystring = require('querystring');

// Build the post string
var xmlDoc = '<document><bank name="Kazkommertsbank JSC"><customer name="Ucaf Test Maest" mail="SeFrolov@kkb.kz" phone="">' +
    '<merchant cert_id="00C182B189" name="test merch"><order order_id="0706172110" amount="1000" currency="398">' +
    '<department merchant_id="92056001" amount="1000"/></order></merchant><merchant_sign type="RSA"/></customer>' +
    '<customer_sign type="RSA"/><results timestamp="2006-07-06 17:21:50"><payment merchant_id="92056001" amount="1000" ' +
    'reference="618704198173" approval_code="447753" response_code="00"/></results></bank>' +
    '<bank_sign cert_id="00c183d690" type="SHA/RSA">' +
    'KswGXFfmYMw1QROTtWXWbQ2NOVNRwIMHzKLg/BmWKlYTFivu3qTy7vetPFS9ny4qAYmy2xXw2EArkcRdCCc6v27xg4j9EE8H7eACHdd9VT227vKhPWtWa9kPEEm4hg2/XwSyQQeipWrHMG7b79xHoSKaJ1u3wUcwIJybEzJOY0ly9IU=' +
    '</bank_sign>' +
    '</document>';

var postData = querystring.stringify({
    response:xmlDoc
})

function PostCode(){
    // An object of options to indicate where to post to
    var post_options = {
        host: 'localhost',
        port: '80',
        path: '/order/payconfirm',
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Content-Length': postData.length
        }
    };
    console.log("Content-Length", postData.length)

    // Set up the request
    var post_req = http.request(post_options, function(res) {
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            console.log('Response: ' + chunk);
        });
    });

    console.log("sending=>", postData);
    // post the data
    post_req.write(postData);
    post_req.end();

}

PostCode();